#include "test_decimal.h"

static float src[] = {0.f,
                      1E-28f,
                      1.00000003E-27f,
                      1.19999996E-27f,
                      1.50000004E-27f,
                      1.89999999E-27f,
                      9.99999989E-27f,
                      1.23000001E-26f,
                      1.50999995E-26f,
                      1.89999999E-26f,
                      1.00000002E-25f,  // 10
                      1.23699997E-25f,
                      1.51899999E-25f,
                      1.90599999E-25f,
                      1.00000002E-24f,
                      2.21370009E-24f,
                      7.51489961E-24f,
                      4.91059997E-24f,
                      1E-23f,
                      1.09999997E-21f,
                      2.21369991E-21f,  // 20
                      7.51490032E-21f,
                      4.91060012E-21f,
                      1.09999997E-20f,
                      2.21369995E-20f,
                      7.51490032E-20f,
                      4.91060003E-20f,
                      1.10000003E-19f,
                      2.21369998E-19f,
                      7.51490019E-19f,
                      4.9106001E-19f,
                      1.09999998E-18f,
                      2.21369993E-18f,
                      7.5149003E-18f,
                      4.91059989E-18f,
                      1.1E-17f,
                      2.21369993E-17f,
                      7.51490013E-17f,
                      4.91060006E-17f,
                      1.1E-16f,
                      2.21369996E-16f,
                      7.51490013E-16f,
                      4.91059993E-16f,
                      1.09999997E-15f,
                      2.21370007E-15f,
                      7.51490002E-15f,
                      4.91059982E-15f,
                      1.10000001E-14f,
                      2.21369994E-14f,
                      7.51490002E-14f,
                      4.91059999E-14f,
                      1.10000001E-13f,
                      2.21370001E-13f,
                      7.51490016E-13f,
                      4.91059992E-13f,
                      1.09999997E-12f,
                      2.21369993E-12f,
                      7.51490016E-12f,
                      4.91060014E-12f,
                      1.10000004E-11f,
                      2.21370006E-11f,
                      7.51489981E-11f,
                      4.91060005E-11f,
                      1.10000002E-10f,
                      2.21370006E-10f,
                      7.51489981E-10f,
                      4.91060026E-10f,
                      1.09999998E-09f,
                      2.21369989E-09f,
                      7.51489981E-09f,
                      4.91059993E-09f,
                      1.1E-08f,
                      -1.f,
                      1.f,
                      -2.f,
                      2.f,
                      -3.f,
                      3.f,
                      -10.f,
                      10.f,
                      -128.f,
                      127.f,
                      255.f,
                      -32768.f,
                      32767.f,
                      -32767.f,
                      137.f,
                      342.f,
                      -32860.f,
                      33223.f,
                      56210.f,
                      -65535.f,
                      65535.f};

static s21_decimal dst[] = {
    {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    {{0x00000001, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000001
    {{0x00000001, 0x00000000, 0x00000000,
      0x001B0000}},  // 0.000000000000000000000000001
    {{0x0000000C, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000012
    {{0x0000000F, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000015
    {{0x00000013, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000019
    {{0x00000001, 0x00000000, 0x00000000,
      0x001A0000}},  // 0.00000000000000000000000001
    {{0x0000007B, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000123
    {{0x00000097, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000151
    {{0x00000013, 0x00000000, 0x00000000,
      0x001B0000}},  // 0.000000000000000000000000019
    {{0x00000001, 0x00000000, 0x00000000,
      0x00190000}},  // 0.0000000000000000000000001
    {{0x000004D5, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001237
    {{0x000005EF, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001519
    {{0x00000772, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001906
    {{0x00000001, 0x00000000, 0x00000000,
      0x00180000}},  // 0.000000000000000000000001
    {{0x00005679, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000049106
    {{0x00000001, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000000001
    {{0x0000000B, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00190000}},  // 0.0000000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00190000}},  // 0.0000000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00190000}},  // 0.0000000000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000,
      0x00150000}},  // 0.000000000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00180000}},  // 0.000000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00180000}},  // 0.000000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00180000}},  // 0.000000000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000,
      0x00140000}},  // 0.00000000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000,
      0x00130000}},  // 0.0000000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00160000}},  // 0.0000000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x00120000}},  // 0.000000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00150000}},  // 0.000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00150000}},  // 0.000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00150000}},  // 0.000000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x00110000}},  // 0.00000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00140000}},  // 0.00000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00140000}},  // 0.00000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00140000}},  // 0.00000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x00100000}},  // 0.0000000000000011
    {{0x00005679, 0x00000000, 0x00000000,
      0x00130000}},  // 0.0000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x00130000}},  // 0.0000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x00130000}},  // 0.0000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000F0000}},  // 0.000000000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x00120000}},  // 0.000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x00120000}},  // 0.000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x00120000}},  // 0.000000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x00110000}},  // 0.00000000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x00110000}},  // 0.00000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x00110000}},  // 0.00000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000D0000}},  // 0.0000000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x00100000}},  // 0.0000000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x00100000}},  // 0.0000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x00100000}},  // 0.0000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000C0000}},  // 0.000000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x000F0000}},  // 0.000000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x000F0000}},  // 0.000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x000F0000}},  // 0.000000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000B0000}},  // 0.00000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x000E0000}},  // 0.00000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x000A0000}},  // 0.0000000011
    {{0x00005679, 0x00000000, 0x00000000, 0x000D0000}},  // 0.0000000022137
    {{0x0001258D, 0x00000000, 0x00000000, 0x000D0000}},  // 0.0000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000, 0x000D0000}},  // 0.0000000049106
    {{0x0000000B, 0x00000000, 0x00000000, 0x00090000}},  // 0.000000011
    {{0x00000001, 0x00000000, 0x00000000, 0x80000000}},  // -1
    {{0x00000001, 0x00000000, 0x00000000, 0x00000000}},  // 1
    {{0x00000002, 0x00000000, 0x00000000, 0x80000000}},  // -2
    {{0x00000002, 0x00000000, 0x00000000, 0x00000000}},  // 2
    {{0x00000003, 0x00000000, 0x00000000, 0x80000000}},  // -3
    {{0x00000003, 0x00000000, 0x00000000, 0x00000000}},  // 3
    {{0x0000000A, 0x00000000, 0x00000000, 0x80000000}},  // -10
    {{0x0000000A, 0x00000000, 0x00000000, 0x00000000}},  // 10
    {{0x00000080, 0x00000000, 0x00000000, 0x80000000}},  // -128
    {{0x0000007F, 0x00000000, 0x00000000, 0x00000000}},  // 127
    {{0x000000FF, 0x00000000, 0x00000000, 0x00000000}},  // 255
    {{0x00008000, 0x00000000, 0x00000000, 0x80000000}},  // -32768
    {{0x00007FFF, 0x00000000, 0x00000000, 0x00000000}},  // 32767
    {{0x00007FFF, 0x00000000, 0x00000000, 0x80000000}},  // -32767
    {{0x00000089, 0x00000000, 0x00000000, 0x00000000}},  // 137
    {{0x00000156, 0x00000000, 0x00000000, 0x00000000}},  // 342
    {{0x0000805C, 0x00000000, 0x00000000, 0x80000000}},  // -32860
    {{0x000081C7, 0x00000000, 0x00000000, 0x00000000}},  // 33223
    {{0x0000DB92, 0x00000000, 0x00000000, 0x00000000}},  // 56210
    {{0x0000FFFF, 0x00000000, 0x00000000, 0x80000000}},  // -65535
    {{0x0000FFFF, 0x00000000, 0x00000000, 0x00000000}},  // 65535
};

static float src_err[] = {INFINITY, -INFINITY};

START_TEST(test) {
  for (size_t i = 0; i < 16; i++) {
    s21_decimal tmp;
    // printf("%d ", i);
    int ret = s21_from_float_to_decimal(src[i], &tmp);
    ck_assert_int_eq(tmp.bits[0], dst[i].bits[0]);
    ck_assert_int_eq(tmp.bits[1], dst[i].bits[1]);
    ck_assert_int_eq(tmp.bits[2], dst[i].bits[2]);
    ck_assert_int_eq(tmp.bits[3], dst[i].bits[3]);
    ck_assert_int_eq(ret, 0);
  }
}
END_TEST

START_TEST(error_test) {
  // src_err[4] = powf(2.0, 96);
  // src_err[5] = -powf(2.0, 96);

  for (size_t i = 0; i < sizeof(src_err) / sizeof(float); i++) {
    s21_decimal tmp;
    // printf("%d ", i);
    int ret = s21_from_float_to_decimal(src_err[i], &tmp);
    ck_assert_int_eq(ret, 1);
  }
}
END_TEST

Suite *suite_from_float_to_decimal(void) {
  Suite *s;
  TCase *tc;

  s = suite_create("\033[102m s21_from_float_to_decimal \033[0m");
  tc = tcase_create("\033[101m s21_from_float_to_decimal \033[0m");

  if (s != NULL && tc != NULL) {
    tcase_add_test(tc, test);
    tcase_add_test(tc, error_test);
    suite_add_tcase(s, tc);
  }

  return (s);
}
